<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envio de Mensagens</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        header { background: navy; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        button { padding: 10px; cursor: pointer; }
        main { background: white; padding: 20px; min-height: 300px; }
        .hidden { display: none; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); width: 50%; border-radius: 10px; display: none; }
        .modal::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: -1; }
        .close-btn { position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 18px; background: red; color: white; padding: 5px; border: none; }
        .record-card { border: 1px solid #ccc; padding: 10px; margin: 5px 0; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <header>
        <h1>Envio de Mensagens</h1>
        <button onclick="toggleMenu()">Menu</button>
    </header>
    
    <nav id="menu" class="hidden">
        <ul>
            <li><a href="pagina1.html">Cadastro de Contatos</a></li>
        </ul>
    </nav>
    
    <main>
        <!-- Barra de pesquisa adicionada -->
        <input type="text" id="search" placeholder="Buscar mensagem..." style="padding: 10px; width: calc(100% - 20px); margin-bottom: 10px;">
        
        <button onclick="openMessageModal()">Enviar Mensagem</button>
        <div id="message-list"></div>
    </main>
    
    <div id="message-modal" class="modal">
        <button class="close-btn" onclick="closeMessageModal()">X</button>
        <h2>Enviar Mensagem</h2>
        <label>Contato</label>
        <select id="contactSelect"></select>
        <label>Mensagem</label>
        <textarea id="messageText"></textarea>
        <button onclick="sendWhatsApp()">Enviar via WhatsApp</button>
        <button onclick="sendEmail()">Enviar via E-mail</button>
    </div>
    
    <div id="info-modal" class="modal">
        <button class="close-btn" onclick="closeInfoModal()">X</button>
        <h2>Detalhes da Mensagem</h2>
        <div id="info-content"></div>
    </div>

    <script>
        function toggleMenu() {
            document.getElementById("menu").classList.toggle("hidden");
        }

        function openMessageModal() {
            document.getElementById("message-modal").style.display = "block";
        }

        function closeMessageModal() {
            document.getElementById("message-modal").style.display = "none";
        }

        function closeInfoModal() {
            document.getElementById("info-modal").style.display = "none";
        }

        function sendMessage(mode) {
            let messages = JSON.parse(localStorage.getItem("messages")) || [];
            let contact = document.getElementById("contactSelect").value;
            let message = document.getElementById("messageText").value;
            let newMessage = {
                id: Math.floor(10000 + Math.random() * 90000),
                contact: contact,
                message: message,
                mode: mode,
                date: new Date().toLocaleString()
            };
            messages.push(newMessage);
            localStorage.setItem("messages", JSON.stringify(messages));
            closeMessageModal();
            loadMessages();
            
            if (mode === "WhatsApp") {
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, "_blank");
            } else if (mode === "E-mail") {
                window.open(`mailto:?subject=Mensagem&body=${encodeURIComponent(message)}`);
            }
        }

        function sendWhatsApp() {
            sendMessage("WhatsApp");
        }

        function sendEmail() {
            sendMessage("E-mail");
        }

        function loadMessages() {
            let filter = document.getElementById("search").value;
            let messages = JSON.parse(localStorage.getItem("messages")) || [];
            let list = document.getElementById("message-list");
            list.innerHTML = "";
            messages.forEach(message => {
                if (message.contact.toLowerCase().includes(filter.toLowerCase()) ||
                    message.message.toLowerCase().includes(filter.toLowerCase()) ||
                    message.mode.toLowerCase().includes(filter.toLowerCase())) {
                    let messageElement = document.createElement("div");
                    messageElement.className = "record-card";
                    messageElement.innerHTML = `<span><strong>${message.contact}</strong> - ${message.mode}</span>
                                              <button onclick="viewMessage(${message.id})">Info</button>
                                              <button onclick="deleteMessage(${message.id})" style="background:red; color:white;">Excluir</button>`;
                    list.appendChild(messageElement);
                }
            });
        }

        function viewMessage(id) {
            let messages = JSON.parse(localStorage.getItem("messages")) || [];
            let message = messages.find(m => m.id === id);
            let content = document.getElementById("info-content");
            content.innerHTML = `<p><strong>Contato:</strong> ${message.contact}</p>
                                <p><strong>Mensagem:</strong> ${message.message}</p>
                                <p><strong>Modo:</strong> ${message.mode}</p>
                                <p><strong>Data:</strong> ${message.date}</p>`;
            document.getElementById("info-modal").style.display = "block";
        }

        function deleteMessage(id) {
            let messages = JSON.parse(localStorage.getItem("messages")) || [];
            messages = messages.filter(m => m.id !== id);
            localStorage.setItem("messages", JSON.stringify(messages));
            loadMessages();
        }

        function loadContacts() {
            let contacts = JSON.parse(localStorage.getItem("contacts")) || [];
            let select = document.getElementById("contactSelect");
            select.innerHTML = "";
            contacts.forEach(contact => {
                let option = document.createElement("option");
                option.value = contact.name;
                option.textContent = contact.name;
                select.appendChild(option);
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            loadMessages();
            loadContacts();
            // Evento para atualizar a lista conforme o usu√°rio digita na barra de pesquisa
            document.getElementById("search").addEventListener("input", loadMessages);
        });
    </script>
</body>
</html>
